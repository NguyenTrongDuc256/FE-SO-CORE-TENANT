<div class="bg-white p-8 h-full border-radius-bg" *transloco="let t; scope: 'student-records'">
  <!-- start header -->
  <div class="d-flex algin-items-center justify-content-between flex-wrap">
    <h3 class="title-compo-global mb-3">{{t('studentRecords.recordsDone')}} </h3>
    <div class="filter d-flex flex-wrap algin-items-center mb-3">
      <select name="cate" id="" [(ngModel)]="cateId" class="so-select mx-4" (ngModelChange)="filter()">
        <option [value]="''">{{t('studentRecords.categoryRecords')}}</option>
        <ng-container *ngFor="let cate of arrCategories">
          <option [value]="cate.id">{{cate.name}}</option>
        </ng-container>
      </select>

      <select name="status" id="" [(ngModel)]="statusRecords" class="so-select" (ngModelChange)="filter()">
        <option [value]="''">{{t('status')}}</option>
        <ng-container *ngFor="let status of arrStatus">
          <option [value]="status.value">{{t(status.label)}}</option>
        </ng-container>
      </select>

      <div class="so-input-search mx-4">
        <nz-input-group [nzSuffix]="suffixIconSearch">
          <input type="text" name="input-search" nz-input placeholder="{{t('studentRecords.search')}}" #searchInput
            (keydown)="search($event, searchInput.value)" />
        </nz-input-group>
        <ng-template #suffixIconSearch>
          <img src="assets/images/svg/search.svg" alt="" nzType="search">
        </ng-template>
      </div>
      <ng-template ngxPermissionsOnly="{{ permission.student_file_user_modify }}">
        <button class="so-btn so-btn-primary so-btn-primary--small" (click)="openModalCreateUpdate('create', null)"
          name="btn-create">
          <img src="assets/images/svg/add.svg" alt="">
          {{t('btnAction.add')}}
        </button>
      </ng-template>
    </div>
  </div>
  <!-- end header -->

  <!-- content -->
  <div class="mt-12">
    <div class="d-flex info-user mb-6">
      <img [src]="infoUser?.avatar || avatarDefault" alt="">
      <div>
        <h4>{{infoUser?.studentName || '--'}}</h4>
        <div>
          <span>
            {{t('birthday')}}:
            <span class="text-link">{{infoUser?.birthday | formatTime}}</span>
          </span>
          <span class="mx-8">
            {{t('class')}}:
            <span class="text-link">{{infoUser?.className || '--'}}</span>
          </span>
          <span>
            {{t("studentRecords.complete")}}:
            <span class="text-link">{{infoUser?.countFileUserImperativeReceived}}/{{infoUser?.countFileUserImperative}}
              {{t('studentRecords.records')}}</span>
          </span>
        </div>
      </div>
    </div>
    <table class="table-global w-full mb-4">
      <caption></caption>
      <thead>
        <th style="width: 3%;" class="text-header-table text-center"> {{t('STT')}}</th>
        <th style="width: 15%;" class="text-header-table"> {{t('studentRecords.nameRecord')}}</th>
        <th style="width: 12%;" class="text-header-table"> {{t('studentRecords.categoryRecords')}} </th>
        <th style="width: 10%;" class="text-header-table"> {{t('studentRecords.createdAt')}} </th>
        <th style="width: 14%;" class="text-header-table"> {{t('studentRecords.createdByName')}} </th>
        <th style="width: 10%;" class="text-header-table"> {{t('status')}} </th>
        <th style="width: 15%;" class="text-header-table"> {{t('studentRecords.fileAttachs')}} </th>
        <th style="width: 15%;" class="text-header-table"> {{t('btnAction.approve')}} </th>
        <ng-template ngxPermissionsOnly="{{ permission.student_file_user_modify }}">
          <th style="width: 10%;" class="text-header-table text-center"> {{t('action')}} </th>
        </ng-template>
      </thead>
      <tbody>
        <ng-container *ngFor="let item of arrList; let i=index">
          <tr>
            <td class="text-center">
              {{isLoading ? (oldPageIndex-1)*pageSize + i + 1 : (pageIndex-1)*pageSize + i + 1}}
            </td>
            <td class="text-content-table text-link fw-600">
              {{item?.name}}
              <span class="icon-mark" *ngIf="item.isImportant == 1">
                <img src="assets/images/svg/icon-mark.svg" alt="">
              </span>
            </td>
            <td>
              {{item?.fileCategoryName}}
            </td>
            <td>
              {{item?.createdAt | formatTime}}
            </td>
            <td>
              {{item?.createByName}}
            </td>
            <td>
              <span class="so-badge so-badge-status so-badge-status-{{item?.approveStatus}}">
                {{t(item?.approveStatusName)}}
              </span>
            </td>
            <td>
              <ng-container *ngFor="let file of item?.fileAttachs">
                <div class="mb-1">
                  <a href="{{file?.url}}" target="_blank" class="text-underline">{{file?.name}}</a>
                </div>
              </ng-container>
            </td>
            <td>
              <div class="d-flex flex-wrap">
                <span class="so-badge so-badge-action so-badge-action--approve me-3 mb-2" id="btn-approve"
                  (click)="changeStatusRecords(item, 'approve')"
                  *ngIf="item?.approveStatus != constStatusRecords.APPROVED">
                  <img src="assets/images/svg/icon-check-square-white.svg" alt="">
                  {{t('btnAction.approve')}}
                </span>
                <span class="so-badge so-badge-action so-badge-action--refuse mb-2" id="btn-refuse"
                  (click)="changeStatusRecords(item, 'refuse')"
                  *ngIf="item?.approveStatus != constStatusRecords.REFUSE">
                  <img src="assets/images/svg/icon-close-white.svg" alt="">
                  {{t('btnAction.refuse')}}
                </span>
              </div>
            </td>
            <ng-template ngxPermissionsOnly="{{ permission.student_file_user_modify }}">
              <td class="text-center">
                <div class="d-flex justify-content-center">
                  <span nz-dropdown [nzDropdownMenu]="menu" nzTrigger="click"
                    class="so-btn-open-drop-menu so-btn-open-drop-menu-no-border d-flex align-items-center justify-content-center"
                    name="btn-open-menu">
                    <img src="assets/images/svg/three_vertical_dot_icon.svg" alt="">
                  </span>
                </div>
                <nz-dropdown-menu #menu="nzDropdownMenu" class="so-drop-menu">
                  <ul nz-menu>
                    <li nz-menu-item (click)="openModalCreateUpdate('update', item)"
                      class="d-flex align-items-center so-item-drop-menu" name="btn-update-role">
                      <img src="assets/images/svg/write.svg" alt="">
                      {{t('btnAction.update')}}
                    </li>
                    <li nz-menu-item (click)="changeMarkRecords(item, 'mark')" *ngIf="item?.isImportant == 0"
                      class="d-flex align-items-center so-item-drop-menu" name="btn-update-role">
                      <img src="assets/images/svg/icon-mark-blue.svg" alt="">
                      {{t('btnAction.markImportantRecords')}}
                    </li>
                    <li nz-menu-item (click)="changeMarkRecords(item, 'unmark')" *ngIf="item?.isImportant == 1"
                      class="d-flex align-items-center so-item-drop-menu" name="btn-update-role">
                      <img src="assets/images/svg/icon-mark-blue.svg" alt="">
                      {{t('btnAction.unmarkImportantRecords')}}
                    </li>
                    <li nz-menu-item (click)="delete(item?.id, item?.name)"
                      class="d-flex align-items-center so-item-drop-menu text-danger" name="btn-delete">
                      <img src="assets/images/svg/icon-delete.svg" alt="">
                      {{t('btnAction.delete')}}
                    </li>
                  </ul>
                </nz-dropdown-menu>
              </td>
            </ng-template>
          </tr>
        </ng-container>
        <tr *ngIf="arrList?.length == 0 || !arrList">
          <td class="text-no-data" colspan="7">{{t('noData')}}</td>
        </tr>
      </tbody>
    </table>

    <app-pagination [pageSize]="pageSize" [pageIndex]="pageIndex" [collectionSize]="collectionSize"
      *ngIf="collectionSize > sizeOption[0]" [sizeOption]="sizeOption" (paginationChange)="paginationChange($event)">
    </app-pagination>
  </div>
  <!-- end content -->
</div>

<div class="spinner" *ngIf="isLoading">
  <app-loading></app-loading>
</div>
